# 2. 도메인 분석하고 설계하기
## 1. 명세 확인

1. 회원 기능
- 회원가입: 이름, 도시, 거리, 우편번호를 입력받아 회원가입
- 회원 목록
2. 상품 기능
- 상품 등록: 상품명, 가격, 수량, 저자, ISBN을 받아 상품을 등록 가능하다. 
- 상품 조회 
- 상품 수정 
3. 주문 기능
- 주문 하기: 회원, 상품명, 갯수를 정해서 주문한다.
- 주문 내역
- 주문 취소
4. 기타 요구사항
- 상품은 재고 관리가 필요하다.
- 상품의 종류는 도서, 음반, 영화가 있다.
- 상품을 카테고리로 구분할 수 있다.
- 상품 주문시 배송 정보를 입력할 수 있다.


## 2. 도메인 모델과 테이블 설계
![domain model table](https://user-images.githubusercontent.com/71186266/200179700-1ce127b6-647c-43da-860e-a82a9d4894a7.png)


### 2.1 **회원, 주문, 상품의 관계 분석하기**
우선 각 도메인들간의 관계를 분석해보자.
1. 회원과 주문은 일대다 관계: 회원은 여러 상품을 주문할 수 있다.
2. 주문과 상품은 다대다 관계: 한 번의 주문에는 여러 상품이 담길 수 있다. **그러나, RDB나, 엔티티에서는 다대다 관계를 사용하지 않는다.** 따라서, **주문 상품 엔티티를 추가해서 다대다 관계를 일대다, 다대일 관계로 풀어냈다.**
3. 주문과 배송은 일대일 관계: 한번의 주문에 한번의 배송이 있다.
### 2.2 **상품 분류하기**
- 상품은 도서, 음반, 영화로 구분된다. **이는 공통 속성을 사용하므로, 상속 구조로 표현됨**

## 3. 회원 엔티티 분석
![model er diagram](https://user-images.githubusercontent.com/71186266/200179701-e519e60b-9580-44b7-b9ca-caac3827e003.png)

- ~~회원을 통해서 주문이 이루어진다.~~, Order에 의해 Member가 있다. 그래서 일대다 관계로 안 보는게 낫지만, 예제를 위해 이렇게 구성하였다고 한다. 

![table](https://user-images.githubusercontent.com/71186266/200182648-ceb68afa-e06d-4472-9f59-8dd4a52a6a64.png)



1. **회원과 주문:** 일대다, 다대일의 관계.
- 회원도 orders로 Order 조회 가능, Order도 member로 맴버 조회 가능. -> **양방향 연관 관계,** 따라서 **`다`에 FK가 존재하게 된다.**
- 외래키가 있는 주문을 연관 관계의 주인으로 정하는 것이 좋다. 그러므로 `Order.member`를 `ORDERS.MEMBER_ID`와 매핑한다. <br> 연관관계의 주인??? 양방향 연관관계 매핑??


2. **주문과 주문 상품:** 일대다 양방향 관계. 주문 하나에 주문 상품이 여러개이다. <br> 외래키가 주문 상품에 있으므로(ORDER_ITEM) **주문 상품이 연관관계의 주인이다.** `OrderItem.order`를 `ORDER_ITEM.ORDER_ID` 외래키와 매핑한다.
3. **주문 상품과 상품:** 다대일, 단방향 관계. <U>ORDER_ITEM에서 OrderItem으로 접근하는 방법이 없음 (그럴 일 없음)</U> `OrderItem.item`을 `ORDER_ITEM.ITEM_ID` 외래키와 매핑
4. **주문과 배송:** 일대일 관계 `Order.delivery`를 `ORDERS.DELIVERY_ID` 외래키와 매핑한다.
5. **카테고리와 상품:** 원래 다대다 없는데 예시를 위해 표현함. `@ManyToMany`를 사용해서 매핑한다. 실무에서는 사용하지 마라.
